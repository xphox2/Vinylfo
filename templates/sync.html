{{ define "sync-page" }}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sync Collection - Vinylfo</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="icon" type="image/x-icon" href="/icons/vinyl-icon.ico">
    <link rel="stylesheet" href="/static/css/sync.css">
</head>
<body>
{{ template "header" }}
<main class="container">
    <h1>Sync Discogs Collection</h1>
    <div id="sync-status" class="sync-status">
        <div id="not-connected" class="status-message error">
            <p>You need to connect your Discogs account first.</p>
            <a href="/settings" class="btn btn-primary">Go to Settings</a>
        </div>
        <div id="sync-ready" class="status-message success hidden">
            <div class="sync-options">
                <h2>Sync Options</h2>
                <div class="sync-mode-selector">
                    <label class="radio-option">
                        <input type="radio" name="sync_mode" value="all-folders" checked>
                        <div class="radio-content">
                            <span class="radio-label">Sync All Folders</span>
                            <span class="radio-description">Iterate through all folders in your collection</span>
                        </div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="sync_mode" value="specific">
                        <div class="radio-content">
                            <span class="radio-label">Sync Specific Folder</span>
                            <span class="radio-description">Choose a specific folder to sync</span>
                        </div>
                    </label>
                </div>
                <div id="folder-selector" class="folder-selector hidden">
                    <label for="selected-folder">Select Folder:</label>
                    <select id="selected-folder"><option value="">Loading folders...</option></select>
                </div>
            </div>
            <div class="sync-actions">
                <button id="start-sync" class="btn btn-secondary">Start Sync</button>
                <button id="refresh-tracks" class="btn btn-secondary" title="Re-fetch track listings from Discogs for all synced albums">Refresh Tracks</button>
                <button id="cleanup-albums" class="btn btn-warning" title="Find and remove albums no longer in your Discogs collection">Cleanup</button>
            </div>
            <p class="sync-hint">Refresh Tracks: Re-syncs track listings. Cleanup: Finds albums removed from Discogs.</p>
        </div>
        
        <!-- Cleanup Modal -->
        <div id="cleanup-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Cleanup Unlinked Albums</h2>
                    <button id="close-cleanup-modal" class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="cleanup-loading" class="cleanup-loading">
                        <p>Scanning Discogs collection...</p>
                        <p class="hint">This may take a moment for large collections.</p>
                    </div>
                    <div id="cleanup-results" class="cleanup-results hidden">
                        <p id="cleanup-summary"></p>
                        <div id="unlinked-albums-list" class="unlinked-albums-list"></div>
                    </div>
                    <div id="cleanup-empty" class="cleanup-empty hidden">
                        <p>All your albums are still in your Discogs collection. Nothing to clean up!</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="delete-selected" class="btn btn-danger hidden">Delete Selected</button>
                    <button id="cancel-cleanup" class="btn btn-secondary">Close</button>
                </div>
            </div>
        </div>
        <div id="sync-running" class="status-message info hidden">
            <div id="sync-mode-info" class="sync-mode-info"></div>
            <p>Syncing...</p>
            <div class="progress-bar"><div id="sync-progress" class="progress-fill"></div></div>
            <p id="sync-progress-text">Starting...</p>
            <p id="sync-folder-info" class="folder-info" style="display: none;"></p>
            <div class="sync-controls">
                <button id="refresh-status" class="btn btn-secondary">Refresh</button>
                <button id="pause-sync" class="btn btn-warning">Pause</button>
                <button id="cancel-sync" class="btn btn-danger">Cancel</button>
            </div>
        </div>
        <div id="sync-complete" class="status-message success hidden">
            <p id="sync-complete-text">Sync completed!</p>
            <p id="sync-summary"></p>
            <button id="start-new-sync" class="btn btn-primary">Sync Again</button>
            <button id="view-albums" class="btn btn-secondary" onclick="location.href='/'">View Albums</button>
        </div>
    </div>
</main>
<footer>
    <p><img src="/icons/vinyl-icon.svg" alt="Vinylfo" class="footer-icon">Vinylfo - Vinyl Music Player</p>
</footer>
<script src="/static/js/sync.js"></script>
</body>
</html>
{{ end }}
